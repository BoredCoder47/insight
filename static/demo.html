<!DOCTYPE html>
<html>
<head>
  <title>Proctoring Backend Demo</title>
  <style>
    body { font-family: Arial; text-align: center; }
    video { border: 2px solid black; }
    pre { background: #f4f4f4; padding: 10px; text-align: left; }
  </style>
</head>
<body>

<h2>Backend Monitoring Demo</h2>

<video id="video" width="320" height="240" autoplay></video>
<br><br>

<button onclick="registerFace()">Register Face</button>
<button onclick="startMonitoring()">Start Monitoring</button>

<h3>Backend Response</h3>
<pre id="output">Waiting...</pre>

<script>
const video = document.getElementById("video");
const output = document.getElementById("output");

let monitoringInterval = null;

// Start webcam
navigator.mediaDevices.getUserMedia({ video: true })
  .then(stream => {
    video.srcObject = stream;
  })
  .catch(err => {
    alert("Camera access denied.");
  });

// Capture frame as blob
function captureFrameBlob() {
  const canvas = document.createElement("canvas");
  canvas.width = 320;
  canvas.height = 240;
  const ctx = canvas.getContext("2d");
  ctx.drawImage(video, 0, 0, 320, 240);

  return new Promise(resolve => {
    canvas.toBlob(blob => resolve(blob), "image/jpeg", 0.7);
  });
}

// Register reference face
async function registerFace() {
  const blob = await captureFrameBlob();
  const formData = new FormData();
  formData.append("file", blob, "frame.jpg");

  const res = await fetch("/register", {
    method: "POST",
    body: formData
  });

  const data = await res.json();
  output.textContent = JSON.stringify(data, null, 2);
}

// Start monitoring loop
function startMonitoring() {
  if (monitoringInterval) return;

  monitoringInterval = setInterval(async () => {
    const blob = await captureFrameBlob();
    const formData = new FormData();
    formData.append("file", blob, "frame.jpg");

    const res = await fetch("/frame", {
      method: "POST",
      body: formData
    });

    const data = await res.json();
    output.textContent = JSON.stringify(data, null, 2);

  }, 500); // every 500ms (~2 FPS)
}
</script>

</body>
</html>
